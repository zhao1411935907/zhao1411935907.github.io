{% extends 'layout.html' %}

{% block title %}Filter Results{% endblock %}

{% block content %}
<div class="container-xxl py-5">
    <div class="container">
        <h1 class="display-5 mb-4">Filter Results</h1>

        {% if saved_filters|length == 0 %}
        <div class="alert alert-info text-center">
            <p>No filter results saved yet.</p>
        </div>
        {% else %}
        <div class="row">
            {% for filter in saved_filters %}
            <div class="col-md-12 mb-3">
                <div class="card">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title">{{ filter.filter_name }}</h5>
                            <!-- Format the card text for a clean, neat layout -->
                            <p class="card-text">
                                <strong>Created on:</strong> {{ filter.created_at.strftime('%B %d, %Y') }}
                            </p>
                        </div>
                        <div class="d-flex align-items-center">
                            <a href="{{ url_for('user.start_filter', filter_id=filter.id) }}" class="btn btn-primary">Start Filter</a>
                            
                            <!-- Dropdown for more options (Rename, Delete) -->
                            <div class="dropdown ms-3">
                                <button class="btn btn-light" type="button" id="dropdownMenuButton{{ filter.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ filter.id }}">
                                    <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#renameModal{{ filter.id }}">Rename</button></li>
                                    <li><button class="dropdown-item delete-btn" data-filter-id="{{ filter.id }}">Delete</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rename Modal -->
            <div class="modal fade" id="renameModal{{ filter.id }}" tabindex="-1" aria-labelledby="renameModalLabel{{ filter.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="renameModalLabel{{ filter.id }}">Rename Filter</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('user.rename_filter', filter_id=filter.id) }}" method="POST">
                                <div class="mb-3">
                                    <label for="filterName" class="form-label">New Filter Name</label>
                                    <input type="text" class="form-control" id="filterName{{ filter.id }}" name="new_filter_name" value="{{ filter.name }}">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<script>
    document.querySelectorAll('.delete-btn').forEach(function(button) {
        button.addEventListener('click', function() {
            const filterId = this.getAttribute('data-filter-id');
            if (confirm('Are you sure you want to delete this filter?')) {
                fetch(`/delete_filter/${filterId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // Reload the page after successful deletion
                        } else {
                            alert('Failed to delete the filter.');
                        }
                    });
            }
        });
    });
</script>

{% endblock %}

